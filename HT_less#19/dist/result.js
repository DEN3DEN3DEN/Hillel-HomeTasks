"use strict";let selectedClient;const openModal=()=>document.getElementById("modal").classList.add("active"),closeModal=a=>{clearFields(),document.getElementById(a).classList.remove("active")},getLocalStorage=()=>JSON.parse(localStorage.getItem("db_client"))??[],setLocalStorage=a=>localStorage.setItem("db_client",JSON.stringify(a)),deleteClient=a=>{const b=readClient();b.splice(a,1),setLocalStorage(b),updateTable(),closeModal("modalConfirm")},updateClient=(a,b)=>{const c=readClient();c[a]=b,setLocalStorage(c)},readClient=()=>getLocalStorage(),createClient=a=>{const b=getLocalStorage();b.push(a),setLocalStorage(b)},isValidfields=()=>document.getElementById("form").reportValidity(),clearFields=()=>{const a=document.querySelectorAll(".modal-field");a.forEach(a=>a.value=""),document.getElementById("name").dataset.index="new"},saveClient=()=>{if(isValidfields()){const a={name:document.getElementById("name").value,password:document.getElementById("password").value,age:document.getElementById("age").value,email:document.getElementById("email").value,phone:document.getElementById("phone").value,bankCard:document.getElementById("bankCard").value},b=document.getElementById("name").dataset.index;"new"==b?(createClient(a),validate(),updateTable(),closeModal("modal")):(updateClient(b,a),validate(),updateTable(),closeModal("modal"))}},createRow=(a,b)=>{const c=document.createElement("tr");c.innerHTML=`
        <td>${a.name}</td>
        <td>${a.password}</td>
        <td>${a.age}</td>
        <td>${a.email}</td>
        <td>${a.phone}</td>
        <td>${a.bankCard}</td>
        <td>
        <button type="button" class="button yellow" id="edit-${b}">Edit</button>
        <button type="button" class="button red" id="delete-${b}">Delete</button>
        </td>
    `,document.querySelector("#tableClient>tbody").appendChild(c)},clearTable=()=>{const a=document.querySelectorAll("#tableClient>tbody tr");a.forEach(a=>a.parentNode.removeChild(a))},updateTable=()=>{const a=readClient();clearTable(),a.forEach(createRow)},fillFields=a=>{document.getElementById("name").value=a.name,document.getElementById("password").value=a.password,document.getElementById("age").value=a.age,document.getElementById("email").value=a.email,document.getElementById("phone").value=a.phone,document.getElementById("bankCard").value=a.bankCard,document.getElementById("name").dataset.index=a.index},editClient=a=>{const b=readClient()[a];b.index=a,fillFields(b),openModal()},editDelete=a=>{if("button"==a.target.type){const[b,c]=a.target.id.split("-");"edit"==b?editClient(c):(selectedClient=c,document.getElementById("modalConfirm").classList.add("active"))}};updateTable(),document.getElementById("registerClients").addEventListener("click",openModal),document.getElementById("modalClose").addEventListener("click",()=>closeModal("modal")),document.getElementById("modalConfirmClose").addEventListener("click",()=>closeModal("modalConfirm")),document.getElementById("cancel").addEventListener("click",()=>closeModal("modal")),document.getElementById("cancelConfirm").addEventListener("click",()=>closeModal("modalConfirm")),document.getElementById("save").addEventListener("click",saveClient),document.querySelector("#tableClient>tbody").addEventListener("click",editDelete),document.getElementById("excludeConfirm").addEventListener("click",()=>deleteClient(selectedClient));const validators={name:{regExp:/^[a-zA-Zа-яА-Я'][a-zA-Zа-яА-Я-' ]+[a-zA-Zа-яА-Я']?$/u,errorMessage:"Name is incorrect"},password:{regExp:/(?=.*[0-9])(?=.*[!@#$%^&*])(?=.*[a-z])(?=.*[A-Z])[0-9a-zA-Z!@#$%^&*]{6,}/g,errorMessage:"Password is incorrect"},age:{regExp:/^\d{2}$/,errorMessage:"Age is incorrect"},email:{regExp:/^([a-z0-9_-]+\.)*[a-z0-9_-]+@[a-z0-9_-]+(\.[a-z0-9_-]+)*\.[a-z]{2,6}$/,errorMessage:"Email is incorrect"},phone:{regExp:/^\+\d{2}\(\d{3}\)\d{3}-\d{2}-\d{2}$/,errorMessage:"Phone is incorrect"},creditCard:{regExp:/^\d{16}$/,errorMessage:"Card is incorrect"}};function validForm(){const{name:{value:a},password:{value:b},age:{value:c},email:{value:d},phone:{value:e},card:{value:f}}=document.forms[0].elements;validate({name:a,password:b,age:c,email:d,phone:e,creditCard:f})?console.log("form valid"):console.log("form is invalid")}function validate(a){let b=0,c=0;for(let d in validators)c++,validators[d].regExp.test(a[d])?b++:console.log(validators[d].errorMessage);return b===c}